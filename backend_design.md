# Backend Design for LegalEase AI

Based on the analysis of the frontend application, the backend will need to support the following functionalities:

## 1. Document Upload and Analysis (Upload Page)

**Frontend Requirements:**
- Accepts file uploads (PDF, DOCX, TXT).
- Simulates analysis and provides a bot response.
- Supports a chat interface for user queries about the uploaded document.

**Backend Endpoints:**

### `POST /upload`
- **Description:** Receives an uploaded document and initiates analysis.
- **Request:**
  - `file`: The uploaded document file.
- **Response:**
  - `document_id`: A unique identifier for the uploaded document.
  - `status`: "analyzing" or "ready".
  - `initial_bot_message`: The initial message from the bot after analysis (e.g., "I've analyzed your document...").

### `POST /chat/upload`
- **Description:** Handles chat messages related to an uploaded document.
- **Request:**
  - `document_id`: The ID of the document being discussed.
  - `message`: The user's message.
- **Response:**
  - `bot_response`: The AI-generated response to the user's query.

## 2. Agreement Generation (Create Page)

**Frontend Requirements:**
- Allows users to select an agreement type (Service, Rental, Employment, NDA, Custom).
- Collects various input fields based on the selected agreement type.
- Simulates PDF generation and download.

**Backend Endpoints:**

### `POST /generate-agreement`
- **Description:** Generates a legal agreement based on user-provided data and agreement type.
- **Request:**
  - `agreement_type`: Type of agreement (e.g., "service", "rental", "employment", "nda", "other").
  - `form_data`: A JSON object containing all relevant fields for the selected agreement type.
- **Response:**
  - `pdf_url`: A URL to the generated PDF document.

## 3. General Chat (Chat Page)

**Frontend Requirements:**
- Provides a general chat interface for users to ask anything.

**Backend Endpoints:**

### `POST /chat/general`
- **Description:** Handles general chat messages.
- **Request:**
  - `message`: The user's message.
- **Response:**
  - `bot_response`: The AI-generated response to the user's query.

## 4. Gemini API Integration

- The backend will use the Gemini API for all AI-powered functionalities, including:
  - Document analysis (summarization, key point extraction, risk assessment).
  - Generating responses for chat interfaces (both document-specific and general).
  - Generating legal agreement content based on predefined points and user input.

## 5. PDF Generation

- The backend will be responsible for generating PDF documents based on the content generated by the Gemini API for agreement creation.
- The PDF generation will incorporate predefined points and allow for dynamic content insertion based on `form_data`.

## Technology Stack

- **Backend Framework:** Flask (Python)
- **AI Model:** Google Gemini API
- **PDF Generation Library:** (To be determined, likely `fpdf2` or `ReportLab` for Python)

## Data Storage

- For simplicity, initially, document analysis results and chat history can be stored in memory or a simple file-based system. For a production environment, a database (e.g., SQLite, PostgreSQL) would be recommended.




## Detailed API Endpoints and Data Models

### `POST /upload`

**Request Body:**
```json
{
  "file_content": "<base64_encoded_file_content>",
  "file_name": "document.pdf",
  "file_type": "application/pdf"
}
```
- `file_content`: Base64 encoded string of the uploaded file. This allows sending binary file data over JSON.
- `file_name`: Original name of the uploaded file.
- `file_type`: MIME type of the uploaded file.

**Response Body (200 OK):**
```json
{
  "document_id": "uuid-of-uploaded-document",
  "status": "analyzing",
  "initial_bot_message": "I've analyzed your document \"document.pdf\". This appears to be a legal agreement. What would you like to know about it? I can help explain clauses, identify potential issues, or answer specific questions."
}
```

**Gemini API Interaction for `/upload`:**
1. Decode the `file_content` from base64.
2. Pass the file content to the Gemini API for analysis. The prompt to Gemini will instruct it to identify the document type, summarize its key points, and suggest potential questions a user might ask.
3. Store the document content and the initial analysis results (summary, identified issues) in a temporary storage associated with the `document_id`.
4. Return the `document_id` and the initial bot message generated by Gemini.

### `POST /chat/upload`

**Request Body:**
```json
{
  "document_id": "uuid-of-uploaded-document",
  "message": "What are the key clauses in this agreement?"
}
```

**Response Body (200 OK):**
```json
{
  "bot_response": "Based on your document, the key clauses include..."
}
```

**Gemini API Interaction for `/chat/upload`:**
1. Retrieve the document content associated with the `document_id` from temporary storage.
2. Combine the user's `message` with the document content and previous chat history (if any) to form a comprehensive prompt for Gemini.
3. Send the prompt to Gemini, instructing it to answer the user's question based on the provided document.
4. Store the user's message and Gemini's response to maintain chat context for future interactions.
5. Return Gemini's response.

### `POST /generate-agreement`

**Request Body:**
```json
{
  "agreement_type": "service",
  "form_data": {
    "serviceProviderName": "Acme Corp",
    "clientName": "Globex Inc.",
    "serviceDescription": "Software development services",
    "serviceFee": "$5000",
    "startDate": "2025-09-01",
    "endDate": "2025-12-31"
  }
}
```
- `agreement_type`: Specifies the type of agreement to generate.
- `form_data`: A dictionary containing all the input fields from the frontend's 


create agreement form.

**Response Body (200 OK):**
```json
{
  "pdf_url": "/path/to/generated_agreement.pdf"
}
```

**Gemini API Interaction for `/generate-agreement`:**
1. Based on the `agreement_type` and `form_data`, construct a detailed prompt for Gemini. This prompt will instruct Gemini to generate the full text of the legal agreement, incorporating the provided `form_data` into predefined clauses and sections. The prompt should also specify the desired legal tone and structure.
2. Send the prompt to Gemini and receive the generated agreement text.
3. Use a PDF generation library (e.g., `fpdf2`) to create a PDF document from the generated text. The PDF generation should include:
    - Standard legal formatting (e.g., proper headings, paragraph numbering).
    - Dynamic insertion of `form_data` into the document.
    - Predefined legal boilerplate clauses that are common for the `agreement_type`.
4. Save the generated PDF to a temporary location on the server.
5. Return the URL to the generated PDF.

### `POST /chat/general`

**Request Body:**
```json
{
  "message": "What is a non-disclosure agreement?"
}
```

**Response Body (200 OK):**
```json
{
  "bot_response": "A non-disclosure agreement (NDA) is a legal contract..."
}
```

**Gemini API Interaction for `/chat/general`:**
1. Send the user's `message` to the Gemini API. The prompt will instruct Gemini to provide a general legal explanation or answer based on its training data.
2. Return Gemini's response.

## Security Considerations

- **API Keys:** Gemini API keys should be stored securely (e.g., environment variables) and never exposed in the frontend.
- **Input Validation:** All incoming data from the frontend should be thoroughly validated to prevent injection attacks or malformed requests.
- **File Handling:** Uploaded files should be scanned for malicious content and stored in a secure, isolated location. Temporary files should be deleted after processing.
- **Authentication/Authorization:** While not explicitly requested by the frontend, for a production application, user authentication and authorization would be crucial to protect API endpoints and user data.

## Scalability and Deployment

- The Flask backend can be deployed using a WSGI server (e.g., Gunicorn) and a reverse proxy (e.g., Nginx) for production.
- For scalability, consider containerization (Docker) and orchestration (Kubernetes).
- The temporary storage for documents and chat history can be replaced with a persistent database (e.g., PostgreSQL, MongoDB) for production-grade applications.

## Predefined Points for PDF Generation

For the PDF generation, the backend will use a templating approach where certain sections are pre-defined, and the Gemini API fills in the dynamic content. This ensures legal accuracy and consistency.

**Example Structure for a Service Agreement:**

```
SERVICE AGREEMENT

This Service Agreement (the "Agreement") is made and entered into as of [Start Date] (the "Effective Date"), by and between:

[Service Provider Name], with its principal place of business at [Service Provider Address - to be added to form_data], (the "Service Provider"),

AND

[Client Name], with its principal place of business at [Client Address - to be added to form_data], (the "Client").

WHEREAS, the Service Provider is engaged in the business of providing [Service Description]; and
WHEREAS, the Client desires to retain the Service Provider to perform certain services as set forth herein.

NOW, THEREFORE, in consideration of the mutual covenants and agreements hereinafter set forth, the parties hereto agree as follows:

1. SERVICES. The Service Provider agrees to perform the following services (the "Services") for the Client:
   [Detailed Service Description from Gemini API based on user input and predefined clauses]

2. COMPENSATION. In consideration for the Services, the Client shall pay the Service Provider the sum of [Service Fee] [Payment Terms - to be added to form_data].

3. TERM. This Agreement shall commence on the Effective Date and shall continue in full force and effect until [End Date], unless earlier terminated in accordance with the provisions of this Agreement.

4. CONFIDENTIALITY. Both parties agree to keep confidential all information obtained during the course of this Agreement.

5. INDEMNIFICATION. Each party agrees to indemnify and hold harmless the other party from and against any and all claims, losses, damages, liabilities, and expenses.

6. GOVERNING LAW. This Agreement shall be governed by and construed in accordance with the laws of [State/Country - to be added to form_data].

IN WITNESS WHEREOF, the parties have executed this Agreement as of the Effective Date.

_____________________________
Service Provider Signature

_____________________________
Client Signature
```

This detailed design will guide the implementation of the backend, ensuring all frontend functionalities are supported and the Gemini API is effectively utilized for legal document processing and generation.

